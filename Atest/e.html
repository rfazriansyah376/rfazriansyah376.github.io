<style>
.recent-posts-horizontal {
  margin: 2rem auto;
  padding: 0 1rem;
  max-width: 1200px;
  position: relative;
}

/* Header sederhana */
.recent-posts-header {
  text-align: center;
  margin-bottom: 2rem;
}

.recent-posts-title {
  font-size: 1.8rem;
  font-weight: 600;
  color: #333;
  margin-bottom: 0.5rem;
}

.recent-posts-subtitle {
  color: #666;
  font-size: 1rem;
  max-width: 600px;
  margin: 0 auto;
  line-height: 1.5;
}

/* Container utama */
.stories-main-container {
  position: relative;
  overflow: hidden;
  border-radius: 12px;
  background: #f8f9fa;
  padding: 1rem;
}

/* Horizontal scroll container */
.horizontal-posts-scroll {
  display: flex;
  overflow-x: auto;
  gap: 1rem;
  padding: 1rem;
  scrollbar-width: none;
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
}

/* Hide scrollbar */
.horizontal-posts-scroll::-webkit-scrollbar {
  display: none;
}

/* Story card sederhana */
.story-card {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  min-height: 280px;
  width: calc(50% - 0.5rem);
  min-width: calc(50% - 0.5rem);
  max-width: calc(50% - 0.5rem);
  flex-shrink: 0;
  border: 1px solid #eaeaea;
  transition: transform 0.2s ease;
  position: relative;
}

.story-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

/* Story profile */
.story-profile {
  position: absolute;
  top: -15px;
  left: 50%;
  transform: translateX(-50%);
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  border: 3px solid white;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.story-profile-icon {
  color: white;
  font-size: 1rem;
  font-weight: bold;
}

/* Story content */
.story-content {
  margin-top: 1.5rem;
  flex: 1;
}

.story-date {
  font-size: 0.8rem;
  color: #667eea;
  margin-bottom: 0.8rem;
  font-weight: 500;
  text-align: center;
}

.story-card h3 {
  font-size: 1.1rem;
  margin-bottom: 0.8rem;
  text-align: center;
  color: #333;
  font-weight: 600;
  line-height: 1.4;
  min-height: 3rem;
}

.story-card h3 a {
  text-decoration: none;
  color: inherit;
}

.story-card h3 a:hover {
  color: #667eea;
}

.story-card p {
  font-size: 0.9rem;
  line-height: 1.6;
  color: #555;
  margin: 0 0 1rem 0;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-align: center;
}

/* Categories tags */
.story-categories {
  display: flex;
  flex-wrap: wrap;
  gap: 0.4rem;
  justify-content: center;
  margin-top: 1rem;
}

.story-tag {
  background: #667eea;
  color: white;
  padding: 0.2rem 0.6rem;
  border-radius: 12px;
  font-size: 0.7rem;
  text-decoration: none;
}

.story-tag:hover {
  background: #5a6fd8;
}

/* Progress indicators */
.progress-container {
  display: flex;
  gap: 0.3rem;
  align-items: center;
  justify-content: center;
  margin-top: 1.5rem;
}

.progress-track {
  width: 30px;
  height: 3px;
  background: #ddd;
  border-radius: 2px;
  cursor: pointer;
}

.progress-track.active {
  background: #667eea;
}

/* Responsive */
@media (max-width: 768px) {
  .story-card {
    width: calc(100% - 0.5rem);
    min-width: calc(100% - 0.5rem);
    max-width: calc(100% - 0.5rem);
  }
  
  .recent-posts-title {
    font-size: 1.5rem;
  }
}

@media (max-width: 480px) {
  .stories-main-container {
    padding: 0.5rem;
  }
  
  .horizontal-posts-scroll {
    padding: 0.5rem;
    gap: 0.5rem;
  }
  
  .story-card {
    padding: 1.2rem;
    min-height: 250px;
  }
}
</style>

<section class="recent-posts-horizontal">
  <div class="recent-posts-header">
    <h2 class="recent-posts-title">Recent Posts</h2>
    <p class="recent-posts-subtitle">Browse through our latest content</p>
  </div>
  
  <div class="stories-main-container">
    <div id="recent-posts-container-horizontal" class="horizontal-posts-scroll">
      <!-- Posts will be loaded here -->
    </div>
  </div>
  
  <div id="progress-container" class="progress-container">
    <!-- Progress bars will be generated here -->
  </div>
</section>

<script>
// Fungsi untuk mendapatkan kategori dari hostname
function getCategoryCandidates(hostname) {      
  const parts = hostname.split('.');      
  if (parts.length < 2) return { sub: null, domain: null };      
  const maybeDomainIndex = parts.length - 3;      
  const domain = (maybeDomainIndex >= 0) ? parts[maybeDomainIndex] : parts[0];      
  const subLabels = (maybeDomainIndex > 0) ? parts.slice(0, maybeDomainIndex) : [];      
  const rawSub = subLabels.length ? subLabels.join('.') : null;      
  const normalize = s => String(s || '').replace(/[-.]+/g, ' ').replace(/\s+/g, ' ').trim().toLowerCase();      
  return { 
    sub: rawSub ? normalize(rawSub) : null, 
    domain: domain ? normalize(domain) : null 
  };      
}      

// Variabel global
let filteredPosts = [];
let currentStoryIndex = 0;
let postsPerView = 2;

// Get initials from title
function getInitials(title) {
  if (!title) return 'A';
  const words = title.split(' ');
  if (words.length === 1) return words[0].charAt(0).toUpperCase();
  return (words[0].charAt(0) + words[1].charAt(0)).toUpperCase();
}

// Format date
function formatDate(dateString) {
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', {
    month: 'short',
    day: 'numeric',
    year: 'numeric'
  });
}

// Filter posts berdasarkan kategori
function filterPostsByCategory(posts) {
  const { sub, domain } = getCategoryCandidates(window.location.hostname);
  const normalize = s => String(s || '').replace(/[-.]+/g, ' ').replace(/\s+/g, ' ').trim().toLowerCase();
  
  let filtered = posts;
  
  // Filter by subdomain category first
  if (sub) {
    filtered = posts.filter(p => 
      Array.isArray(p.categories) && 
      p.categories.some(c => normalize(c) === sub)
    );
  }
  
  // If no posts found with subdomain, try domain
  if (filtered.length === 0 && domain) {
    filtered = posts.filter(p => 
      Array.isArray(p.categories) && 
      p.categories.some(c => normalize(c) === domain)
    );
  }
  
  // If still no posts, show all posts
  if (filtered.length === 0) {
    filtered = posts;
  }
  
  return filtered;
}

// Setup touch navigation
function setupTouchNavigation() {
  const container = document.getElementById('recent-posts-container-horizontal');
  let isDragging = false;
  let startX = 0;
  let scrollLeft = 0;
  
  // Mouse events
  container.addEventListener('mousedown', (e) => {
    isDragging = true;
    startX = e.pageX - container.offsetLeft;
    scrollLeft = container.scrollLeft;
  });
  
  container.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    e.preventDefault();
    const x = e.pageX - container.offsetLeft;
    const walk = (x - startX) * 1.5;
    container.scrollLeft = scrollLeft - walk;
  });
  
  container.addEventListener('mouseup', () => {
    isDragging = false;
    updateCurrentStory();
  });
  
  container.addEventListener('mouseleave', () => {
    isDragging = false;
  });
  
  // Touch events
  container.addEventListener('touchstart', (e) => {
    isDragging = true;
    startX = e.touches[0].pageX - container.offsetLeft;
    scrollLeft = container.scrollLeft;
  });
  
  container.addEventListener('touchmove', (e) => {
    if (!isDragging) return;
    const x = e.touches[0].pageX - container.offsetLeft;
    const walk = (x - startX) * 1.2;
    container.scrollLeft = scrollLeft - walk;
  });
  
  container.addEventListener('touchend', () => {
    isDragging = false;
    updateCurrentStory();
  });
  
  // Scroll event
  container.addEventListener('scroll', () => {
    updateCurrentStory();
  });
}

// Update current story based on scroll
function updateCurrentStory() {
  const container = document.getElementById('recent-posts-container-horizontal');
  const scrollPosition = container.scrollLeft;
  const storyWidth = container.children[0]?.offsetWidth || 300;
  const gap = 16;
  
  const newIndex = Math.round(scrollPosition / (storyWidth + gap));
  const totalPages = Math.ceil(filteredPosts.length / postsPerView);
  
  if (newIndex !== currentStoryIndex && newIndex >= 0 && newIndex < totalPages) {
    currentStoryIndex = newIndex;
    updateProgressIndicators();
  }
}

// Setup progress indicators
function setupProgressIndicators() {
  const container = document.getElementById('progress-container');
  const totalPages = Math.ceil(filteredPosts.length / postsPerView);
  
  container.innerHTML = '';
  
  for (let i = 0; i < totalPages; i++) {
    const track = document.createElement('div');
    track.className = `progress-track ${i === currentStoryIndex ? 'active' : ''}`;
    track.onclick = () => goToStory(i);
    container.appendChild(track);
  }
}

// Update progress indicators
function updateProgressIndicators() {
  const tracks = document.querySelectorAll('.progress-track');
  tracks.forEach((track, index) => {
    track.classList.toggle('active', index === currentStoryIndex);
  });
}

// Navigate to specific story
function goToStory(index) {
  const container = document.getElementById('recent-posts-container-horizontal');
  const storyWidth = container.children[0]?.offsetWidth || 300;
  const gap = 16;
  
  currentStoryIndex = index;
  const scrollPosition = index * (storyWidth + gap);
  
  container.scrollTo({
    left: scrollPosition,
    behavior: 'smooth'
  });
  
  updateProgressIndicators();
}

// Render posts
function renderPosts() {
  const container = document.getElementById('recent-posts-container-horizontal');
  container.innerHTML = '';
  
  // Show all filtered posts
  filteredPosts.forEach((post, index) => {
    const storyCard = document.createElement('div');
    storyCard.className = 'story-card';
    
    // Story profile
    const profileDiv = document.createElement('div');
    profileDiv.className = 'story-profile';
    const profileIcon = document.createElement('div');
    profileIcon.className = 'story-profile-icon';
    profileIcon.textContent = getInitials(post.title);
    profileDiv.appendChild(profileIcon);
    storyCard.appendChild(profileDiv);
    
    // Story content
    const contentDiv = document.createElement('div');
    contentDiv.className = 'story-content';
    
    // Date
    const dateDiv = document.createElement('div');
    dateDiv.className = 'story-date';
    dateDiv.textContent = formatDate(post.date || new Date());
    contentDiv.appendChild(dateDiv);
    
    // Title
    const h3 = document.createElement('h3');
    const linkTitle = document.createElement('a');
    linkTitle.href = post.url || '#';
    linkTitle.textContent = post.title || '(no title)';
    h3.appendChild(linkTitle);
    contentDiv.appendChild(h3);
    
    // Excerpt
    const desc = document.createElement('p');
    desc.textContent = post.excerpt || 'Click to read full story...';
    contentDiv.appendChild(desc);
    
    // Categories
    if (post.categories && post.categories.length > 0) {
      const categoriesDiv = document.createElement('div');
      categoriesDiv.className = 'story-categories';
      
      post.categories.slice(0, 2).forEach(category => {
        const tag = document.createElement('a');
        tag.className = 'story-tag';
        tag.href = '#';
        tag.textContent = category;
        categoriesDiv.appendChild(tag);
      });
      
      contentDiv.appendChild(categoriesDiv);
    }
    
    storyCard.appendChild(contentDiv);
    container.appendChild(storyCard);
  });
  
  setupTouchNavigation();
  setupProgressIndicators();
}

// Render no posts message
function renderNoPosts() {
  const container = document.getElementById('recent-posts-container-horizontal');
  const progressContainer = document.getElementById('progress-container');
  
  container.innerHTML = `
    <div class="story-card" style="text-align: center; padding: 3rem 1rem; width: 100%;">
      <h3 style="color: #666; margin-bottom: 1rem;">No posts found</h3>
      <p style="color: #888;">Try visiting another category or check back later.</p>
    </div>
  `;
  
  progressContainer.style.display = 'none';
}

// Load and process posts
fetch('/posts.json')
  .then(res => {
    if (!res.ok) throw new Error('Failed to load posts.json');
    return res.json();
  })
  .then(posts => {
    if (!Array.isArray(posts) || posts.length === 0) {
      renderNoPosts();
      return;
    }
    
    // Sort by date (newest first)
    posts.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    // Filter posts by category/domain
    filteredPosts = filterPostsByCategory(posts);
    
    // Update title based on filter
    const { sub, domain } = getCategoryCandidates(window.location.hostname);
    const title = document.querySelector('.recent-posts-title');
    const subtitle = document.querySelector('.recent-posts-subtitle');
    
    if (sub && filteredPosts.length > 0) {
      title.textContent = `${sub.charAt(0).toUpperCase() + sub.slice(1)} Posts`;
      subtitle.textContent = `Latest content in ${sub}`;
    } else if (domain && filteredPosts.length > 0) {
      title.textContent = `${domain.charAt(0).toUpperCase() + domain.slice(1)} Posts`;
      subtitle.textContent = `Latest content in ${domain}`;
    } else if (filteredPosts.length > 0) {
      title.textContent = 'All Recent Posts';
      subtitle.textContent = 'Browse through our latest content';
    }
    
    // Render posts
    renderPosts();
  })
  .catch(err => {
    console.error('Error loading posts:', err);
    renderNoPosts();
  });
</script>
