<div id="random-content2">Memuat...</div>

<script>
(function() {
  const container = document.getElementById('random-content2');
  if (!container) return;

  async function loadFromJson() {
    try {
      // 1. Ambil includes.json via jsDelivr CDN
      const jsonUrl = 'https://cdn.jsdelivr.net/gh/nengmaya538/nengmaya538.github.io/assets/data/includes.json?nocache=' + Date.now();
      
      const jsonResponse = await fetch(jsonUrl);
      
      if (!jsonResponse.ok) {
        throw new Error('Gagal mengambil daftar file');
      }
      
      const files = await jsonResponse.json();
      
      if (!files || files.length === 0) {
        throw new Error('Daftar file kosong');
      }
      
      // 2. Pilih file random
      const randomIndex = Math.floor(Math.random() * files.length);
      let selectedFile = files[randomIndex];
      
      // 3. Pastikan ekstensi .html
      if (!selectedFile.toLowerCase().endsWith('.html')) {
        selectedFile = selectedFile + '.html';
      }
      
      console.log(`Memilih: ${selectedFile}`);
      
      // 4. Ambil konten via CDN
      const contentUrl = `https://cdn.jsdelivr.net/gh/nengmaya538/nengmaya538.github.io/includes/${selectedFile}`;
      const contentResponse = await fetch(contentUrl + '?nocache=' + Date.now());
      
      if (!contentResponse.ok) {
        throw new Error(`Gagal mengambil ${selectedFile}`);
      }
      
      const html = await contentResponse.text();
      container.innerHTML = html;
      
      // 5. Eksekusi script
      const scripts = container.getElementsByTagName('script');
      for (let i = scripts.length - 1; i >= 0; i--) {
        const newScript = document.createElement('script');
        if (scripts[i].src) {
          newScript.src = scripts[i].src;
        } else {
          newScript.textContent = scripts[i].textContent;
        }
        scripts[i].parentNode.replaceChild(newScript, scripts[i]);
      }
      
    } catch (error) {
      console.error('Error:', error);
      container.innerHTML = `
        <div style="padding:20px; text-align:center;">
          <p>Gagal memuat: ${error.message}</p>
          <button onclick="location.reload()">Coba Lagi</button>
        </div>
      `;
    }
  }

  loadFromJson();
})();
</script>
