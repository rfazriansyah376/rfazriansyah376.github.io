<div id="random-content2"></div>

<script>
  (function () {
    var container = document.getElementById("random-content2");
    if (!container) return;

    // Fungsi untuk membuat parameter anti-cache
    function addAntiCache(url) {
      var separator = url.indexOf('?') === -1 ? '?' : '&';
      return url + separator + 'nocache=' + Date.now();
    }

    // Ambil daftar file dari includes.json
    var jsonUrl = addAntiCache("/assets/data/includes.json");
    
    // Gunakan teknik fetch dengan mode no-cors
    fetch(jsonUrl, {
      method: 'GET',
      mode: 'cors', // Ubah ke 'cors' dari 'no-cors'
      headers: {
        'Accept': 'application/json'
      }
    })
    .then(function(response) {
      if (!response.ok) {
        throw new Error('HTTP error ' + response.status);
      }
      return response.json();
    })
    .then(function(files) {
      if (!files || !files.length) {
        throw new Error('Tidak ada file tersedia');
      }

      // Pilih file random
      var randomIndex = Math.floor(Math.random() * files.length);
      var randomFile = files[randomIndex];
      
      // Pastikan ekstensi .html
      if (!randomFile.endsWith('.html')) {
        randomFile = randomFile + '.html';
      }

      // Ambil konten HTML
      var htmlUrl = addAntiCache("/includes/" + randomFile);
      
      return fetch(htmlUrl, {
        method: 'GET',
        mode: 'cors',
        headers: {
          'Accept': 'text/html'
        }
      });
    })
    .then(function(response) {
      if (!response.ok) {
        throw new Error('HTTP error ' + response.status);
      }
      return response.text();
    })
    .then(function(html) {
      // Inject HTML langsung ke container
      container.innerHTML = html;
      
      // Jalankan script jika ada di dalam HTML
      var scripts = container.getElementsByTagName('script');
      for (var i = 0; i < scripts.length; i++) {
        var script = document.createElement('script');
        if (scripts[i].src) {
          script.src = scripts[i].src;
        } else {
          script.textContent = scripts[i].textContent;
        }
        scripts[i].parentNode.replaceChild(script, scripts[i]);
      }
    })
    .catch(function(error) {
      console.error("Error:", error);
      container.innerHTML = `
        <div style="padding:20px; text-align:center; color:#666; font-family:system-ui, sans-serif;">
          <p>Maaf, konten tidak dapat dimuat.</p>
          <p style="font-size:14px; color:#999;">${error.message}</p>
          <p><button onclick="location.reload()" style="padding:5px 15px; cursor:pointer;">Muat ulang</button></p>
        </div>
      `;
    });
  })();
</script>
