


<h2>Related Posts From My Blogs</h2>
<div id="galleryContainer"></div>
<div id="galleryNav"><br /><center>
  <button id="prevBtn" disabled>Prev</button>
  <button id="nextBtn">Next</button></center><br /><hr />
</div>
<script>
(function(){
  const blogIds = ["3878198361264397837", "6519813201877455483", "2518978342274940385",  "6298105943168307485", "6675952122275127810",  "5712209933519777277", "140559017400073092", "8773139630832293067", "6764234585013224192", "1400031344750959946", "5979164315421161613", "9148581686795103299", "4844345345158927306", "285918422181784799", "940918861542288052", "9016411749836243366", "7279187020501880908", "4579729634053134157", "8433632148960902051", "6356911602229545033", "129917453826659385", "2109345921300850083", "8602943951544152759", "7201895562314409755", "2048832942578984151", "5995074279736401487", "1401851771010929030"]; // daftar blog
  const label = "tag01";
  const maxResults = 150;
  const container = document.getElementById("galleryContainer");
  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");

  let startIndex = 1; // halaman pertama
  let loaded = 0;

  function clearGallery() {
    container.innerHTML = "";
    loaded = 0;
  }

  function extractImageFromContent(content) {
    let div = document.createElement("div");
    div.innerHTML = content;
    let imgTag = div.querySelector("img");
    if (imgTag) {
      return imgTag.src.replace(/=s72-c/, "=s1600");
    }
    return null;
  }

  function extractSnippet(content) {
    let div = document.createElement("div");
    div.innerHTML = content;
    let pTag = div.querySelector("p");
    if (pTag) {
      return pTag.outerHTML; // ambil <p> pertama utuh dengan HTML
    }
    return "";
  }

  function handleReindrinse(blogId, data) {
    if (data && data.feed && data.feed.entry) {
      data.feed.entry.forEach(entry => {
        let title = entry.title.$t;
        let link = entry.link.find(l => l.rel === "alternate").href;

        // ambil domain blog dari link utama
        let blogDomain = "";
        try {
          let urlObj = new URL(link);
          blogDomain = urlObj.origin;
        } catch(e) {}

        // ambil label postingan
        let labels = [];
        if (entry.category && blogDomain) {
          labels = entry.category.map(cat => {
            return `<a href="${blogDomain}/search/label/${encodeURIComponent(cat.term)}" target="_blank">${cat.term}</a>`;
          });
        }

        // ambil gambar dari konten
        let thumb = entry.content ? extractImageFromContent(entry.content.$t) : null;

        // fallback ke thumbnail standar
        if (!thumb && entry.media$thumbnail) {
          thumb = entry.media$thumbnail.url.replace(/=s72-c/, "=s1600");
        }

        // fallback terakhir: placeholder
        if (!thumb) {
          thumb = "https://via.placeholder.com/1280x720?text=No+Image";
        }

        // ambil snippet (paragraf pertama utuh)
        let snippet = entry.content ? extractSnippet(entry.content.$t) : "";

        let item = document.createElement("div");
        item.innerHTML = `
          <h3 class="post-title" itemprop="name">
            <a href="${link}" target="_blank" itemprop="url">${title}</a>
          </h3>
          ${snippet ? `<div class="post-snippet">${snippet}</div>` : ""}
          ${labels.length > 0 ? `<p class="spo">${labels.join(", ")}</p>` : ""}
        `;
        container.appendChild(item);
      });
    }
    loaded++;
    if (loaded === blogIds.length && container.innerHTML === "") {
      container.innerHTML = "<p>No More Post</p>";
    }
  }

  function loadPosts() {
    clearGallery();
    blogIds.forEach(blogId => {
      let script = document.createElement("script");
      script.src = `https://www.blogger.com/feeds/${blogId}/posts/default/-/${encodeURIComponent(label)}?alt=json-in-script&max-results=${maxResults}&start-index=${startIndex}&callback=handle${blogId}`;
      window["handle"+blogId] = (data) => handleReindrinse(blogId, data);
      document.body.appendChild(script);
    });
  }

  // tombol next prev
  nextBtn.addEventListener("click", function(){
    startIndex += maxResults;
    prevBtn.disabled = false;
    loadPosts();
  });

  prevBtn.addEventListener("click", function(){
    if (startIndex > 1) {
      startIndex -= maxResults;
      if (startIndex <= 1) {
        prevBtn.disabled = true;
      }
      loadPosts();
    }
  });

  // load pertama kali
  loadPosts();

})();
</script>

  
